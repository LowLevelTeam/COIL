# COIL Configuration Format

## 1. Introduction

The COIL Configuration Format provides a unified interface for controlling the compilation process, specifying target capabilities, and configuring COIL processors. It allows for detailed specification of architecture features, memory models, security settings, and linker behavior.

## 2. Format Structure

The configuration uses a simple key-value format with section headers:

```
[section_name]
key1 = value1
key2 = value2

[another_section]
key3 = value3
```

Section headers are enclosed in square brackets, and each key-value pair is on a separate line with an equals sign separator.

## 3. Core Sections

### 3.1 Device Section

The device section specifies the target processing unit and architecture:

```
[device]
type = cpu          ; Processing unit type (cpu, gpu, etc.)
arch = x86_64       ; Architecture
processor = intel   ; Processor manufacturer
model = skylake     ; Specific processor model
features = avx2,bmi2,fma    ; Supported features
```

In COIL v1, only CPU is fully supported as the device type, but the configuration format includes placeholders for other device types to be supported in future versions.

### 3.2 Memory Section

The memory section defines the memory model and alignment requirements:

```
[memory]
model = x86_64      ; Memory model
endian = little     ; Endianness (little, big)
alignment = 16      ; Default alignment
pointer_size = 64   ; Pointer size in bits
```

### 3.3 Security Section

The security section specifies security features to consider during compilation:

```
[security]
features = nx,aslr  ; Security features to support
sanitize = address  ; Sanitizer to apply
```

### 3.4 Linker Section

The linker section defines how the code should be linked:

```
[linker]
sections = .text,.data,.bss
entry = main
symbols = global
```

### 3.5 Optimization Section

The optimization section controls compilation optimizations:

```
[optimization]
level = 2           ; Optimization level (0-3)
size = false        ; Optimize for size
inline = auto       ; Inlining strategy
vectorize = true    ; Enable vectorization
```

## 4. Device Mode Configuration

For targets with multiple modes (e.g., x86 protected mode vs. long mode), each mode can be configured separately:

```
[device.mode.0]
name = protected     ; Mode name
features = ...       ; Features in this mode

[device.mode.1]
name = long          ; Mode name
features = ...       ; Features in this mode
```

These modes can be selected at compile time using the `MODE` directive in COIL code.

## 5. Multi-Device Configuration (v3)

While COIL v1 focuses on single-device targeting, the configuration format includes placeholder sections for multi-device support in v3:

```
[devices]
count = 2

[device.0]
type = cpu
...

[device.1]
type = gpu
...

[interconnect]
topology = bus
bandwidth = 16GB/s
latency = 100ns
```

## 6. Usage in COIL Processors

COIL processors use the configuration file to:

1. Determine what features to enable or disable
2. Select the appropriate instruction encoding
3. Optimize code for the target architecture
4. Configure the linker for the target platform
5. Set up the debug environment

## 7. Configuration Distribution

Configuration files can be:

1. Distributed with COIL processors as presets for common platforms
2. Generated by build systems based on target detection
3. Created manually for specific custom targets
4. Embedded in COIL object files for self-contained distribution

## 8. Implementation Requirements

A COIL v1 processor must:

1. Be able to parse the full configuration format
2. Apply all relevant settings for CPU targets
3. Issue clear errors for unsupported configurations
4. Provide default values for missing settings
5. Support at least a basic set of predefined configurations for common architectures

## 9. Best Practices

1. Use the most specific configuration possible for your target
2. Include all relevant security features for production builds
3. Document any custom configuration settings
4. Validate configurations before using them in production
5. Use conditional compilation with different configurations for multi-architecture support